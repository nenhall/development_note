# 图形学基础

上一章中讲了坐标转换和像素计算、硬件显示

## 笛卡尔坐标系

笛卡尔坐标系会称为二维笛卡尔坐标系：这个名字来源于法国数学家**勒内*笛卡尔**

上一章画了几何图形，那几何图形是如何确认自己的位置的？

我们在编写代码的时候新建了正方开左上方的坐标点（50, 50），此时正方形的坐标X值和Y值都为50，而50是相对左上方原点(0, 0)确定的，因为原点向下为Y轴正方向，向右为X轴正方向，所以正方形左上方的坐标值都为正。

![](https://blog-1257063273.cos.ap-chengdu.myqcloud.com/2020/dikaframe.png)

笛卡尔坐标系也称二维直角坐标系，是由两条相互垂直、0点重合的数轴构成的。

从本章开始的图中，从原点开始向下是Y轴正方向，但是在演示二维笛卡坐标系时，从原点开始向上是Y轴正方向，这里方向不同是因为使用了不同的二维笛卡坐标系时，准确来讲是不同方向的二维笛卡坐标系。

在iOS开发中，不使用不同的框架时，二维笛卡尔坐标系的方向也会不同。例如：使用UIKit 时，坐标系的Y轴向下为正，当使用Core Graphics和OpenGL ES时，坐标系的Y轴向上为正。所以在开发中，如果需要向上下文中绘制图片，但发现图片最终呈现的效果会上下颠倒，那么这时候就要留意可能是因为坐标系方向不同造成的。

## 三维笛卡坐标系

三维笛卡坐标系涉及到三维空间，它多了个Z轴，三条数轴之间相互垂直，如下图

和二维笛卡尔坐标系具有不同的方向特性，三维笛卡尔坐标系也具有不同的方向，这种不同的方向导致坐标系分为左手坐标系和右手坐标系。

区分左手坐标系和右手坐标系有一个很简单的办法，如下图所示中心交叉点为左右分界线，大拇指、食指、中指分别代表坐标系的X、Y、Z轴，如果都为正方向（数值为正数）的，此为右手坐标系；左手坐标系相反。

![三维笛卡坐标系](https://blog-1257063273.cos.ap-chengdu.myqcloud.com/2020/sanwei.png)

 ## 坐标空间

坐标空间在我们生活也息息相关，你从一个地方到另一个地方，你需要经过向不同方位走不同和行程，如左转100米再右转200米。或者用另一种说法：向东走100米再向南走200米，最终的目的都一样，只是描述的方法不同，我们可以称之为**空间转换**。

```mermaid
graph LR
A(模型空间) -->B(世界空间) -->C(观察空间) -->D(截剪空间) -->E(屏幕空间)
```

1. 刚开始我们处在自己的坐标空间，类似于我们的上下左右】前后方向，所有行为都是依据自己视学来进行的，称为**模型空间**
2. 我们要去寻找的另外一个地方，那这个地方就是相对你而言的，所以这个时候，你和另外的事物处在同一个环境中，这称为**世界空间**
3. 当我们自己和另外的事物处在同一个环境中，这个时间从另一个角度，类似于从空中俯瞰，当在不同的方向观察自己和其他事物时，又会呈现不同的样子，这称为**观察空间**。
4. 不管我们怎么观察，距离主个环境近或者远，我们的视觉都是有限的，也就是说只能看见我们视觉内的事物，那些视觉外的事物就要被排除，这称为**裁剪空间**。
5. 经过排队操作后，我们就不再处于三维环境中，而是处在二维环境里，并且排队操作完成以后，我们得到的是一张二维照片，现在可以把这张照片映射到屏幕上，最后就得到了**屏幕空间**。

## 坐标系转换

1. 在三维环境下，大部份元素模型的形式存在，而每个模型都有自己的坐标系，就是二维环境下每个图形的bounds，存在于模型空间中，称为**模型坐标系**。
2. 而所有模型都在一个环境中，就像游戏场景中的很多元素都场景中一样，在这个环境中，，每个模型都有相应的坐标位置，对应二维环境下每个图形的 frame，称为**世界坐标系**。
3. 此时模型都看球三维环境中，但是我们最终要将其转换成二维图片，才能绘制到屏幕上，所以就需要从某个角度去观察模型，这样你观察到的画面就是二维的，此时坐标系就会被黑的为**观察坐标系**。
4. 接下来就会把当前环境放入一个归一化设备坐标系中，坐标范围是-1~1或者0~1（和系统有关）。这里先不理解什么叫归一化设备，暂理解为一个立方休，由于它的坐标系范围固定，所以与任何输出设备的坐标系范围都没有关系，此时坐标系就会被转换为**归一化设备坐标系**，映射到这个立方体中，就开始进行裁剪，因为有些模型的部分不在视野范围内，所以在不视野范围之内的部分就全部裁剪掉。
5. 剪裁完毕以后，再映射成**屏幕坐标系**，图形扫描转换到缓冲区中，屏幕会从缓冲区中获取数据进行显示

## 硬件设备

### 阴极射线管

一个典型的阴极射线管由4个部件组成：电子枪(从头到聚集控制部分都算为电子枪部分)，聚集系统、偏转系统，荧光层。

按那种老式的大头显示器业说：显示图像的最后一步是用基于阴极射线管（CRT）技术的显示器来显示图像，但也可以使用基于其它技术的显示器。

![阴极射线管原理图](https://blog-1257063273.cos.ap-chengdu.myqcloud.com/2020/timg.gif)

当荧光层受到轰击后，会在一定的时间内保持激活状态，也就是说亮点只能持续很短时间，所以必须快速循环地轰击荧光层，相当于反复地重画图像，以此来形成一个稳定的画面，在屏幕上重复画图的频率叫作刷新频率，每秒可以进行多少次重画可作为衡量画面质量的标准，通常用帧频来表示，帧频越大，画面就越流畅，帧频的单位为赫兹（Hz），24Hz 可以保证图像内容连续的感觉，48Hz 可以保证没有闪烁的感觉。

在开发中，一般要保证每一步操作的运行时间最长在16ms 之内，原因就是要保证1s 内刷新60次，也就是帧频为60Hz，这样用户在使用过程中才会感觉流畅。

### 彩色阴极射线管

电子枪发射出来的电子束因为没有颜色状态，只有强度和高底状态，所以如果想要显示多种颜色，就必须依靠显示屏内表面上的荧光粉图层，我们刚讲到荧光粉只有一种颜色：点亮就是白色，不点亮就是黑色，或者根据电子束强度的高低来显示不同的程度的灰色。

如果要显示多种颜色，那么可以在荧光层上涂满按照一定方式紧密排列的红、绿、蓝三种颜色的荧光粉点，每一个荧光粉点称为荧光粉单元，每相邻的红、绿、蓝荧光粉单元组成一组，称为**像素**。这样每一个像素就拥有红、绿、蓝三基色。此时电子枪的个数会从一个变成三个，三个电子枪发射出三束电子束，分别去轰击对应的三个荧光粉单元，也就是**三基色**

三基色受到电子束不同强度的轰击后，分别发出强弱不同的红、绿、蓝三种颜色，因为超过一定距离后，人眼就会分辨不出三基色，只能看到三基色混合后的颜色，这样一来，每个像素就会呈现不同的颜色，所有像素加起来就会形成图像，不断变化的图形就可以让屏幕显示不同的状态，如下图：

![彩色阴极射线管](https://blog-1257063273.cos.ap-chengdu.myqcloud.com/2020/timg-1.gif)

因为在刷新过程中，三束电子束要正确的对应三基色，这样才能确保颜色的正确显示，而这里要保证正确的颜色显示，就要借后边另一个部件：**荫罩**。它位于屏幕后面，上面有很多小孔或者细槽，每一个小孔或者细槽对应一个像素，三束电子束经过小孔后，就可以正确轰击对应像素的三基色，这样就可以保证颜色的正常显示了，相邻的像素颜色也不会相互干扰。

![](https://blog-1257063273.cos.ap-chengdu.myqcloud.com/2020/laosidianshi.jpeg)

上述两类都是主机显示屏，都是那种大头比较经典一类

### LCD 和 OLED

现在基本上采用液晶显示器，也就是 LCD（Liquid Crystal Displa）。它与前两者相比，具有厚度薄、重量轻、平面展示、低有耗等特点。所以现在手机屏幕都采用了 LCD 材质的显示屏，iphon 系列也都用 LCD 材质的屏幕，不过在2017 Apple秋季发布推出 iPhone X 采用了 OLED 屏幕，接下来介绍下 LCD 的显示原理。

物质可以分为固态、液态、气态三种形态，而液晶则会介于固态和液态之间，是具有规则性分子排列的有机化合物。在不同的电场作用下，液晶分子会做规则旋转90°排列，产生透光度的差别，可以依据这个特性来控制是否发光，如下图所示，在实际应用中，由发光源和背光模组一起来提供背光，然后用电场来对液晶分子进行控制，这样可以按需来控制是否发光，以此来形成不同亮度的点阵，点阵中的光再结合彩色滤光片就可以实现彩色显示。从图中可以看到，LCD 是依靠背光模组来进行发光的，所以这就限制了它的厚度不能再降低。

![LCDStructure](https://blog-1257063273.cos.ap-chengdu.myqcloud.com/2020/LCDStructure.png)

iPhoneX 上搭载的 OLED 屏幕则采用了自发光技术，这样就把上图中的发光源，背光模组、液晶分子，彩色滤光片合成为一个器件，所以大降代了厚度，可以做到很薄。而且 OLED 发光材质是由很小的 LED “灯泡” 组成的阵列，不仅可以发光，还可以发出颜色，所以它的颜色会更加绚丽，还有一个重要的特性就是：LCD 是因为发光原理的限制，当呈现一画面进行刷新时，液晶旋转会占用较长的时间，这样就会给画面刷新造成延迟，而且还会产生余晖效应，而 OLED 因为是自发光，发光的 LED“灯泡”会讯速更新状态，从而大减少了画面刷新时所需要的时间，正因为这种特性，现在的 VR 显示屏都采用了 OLED。